{"ast":null,"code":"var _class;\nimport { ElementRef } from '@angular/core';\nimport { FormControl, Validators, FormControlName } from '@angular/forms';\nimport { fromEvent, merge } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { NumberValidators } from '../shared/number.validator';\nimport { GenericValidator } from '../shared/generic-validator';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"./product.service\";\nimport * as i4 from \"@angular/common\";\nfunction ProductEditComponent_div_48_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"label\", 31);\n    i0.ɵɵtext(2, \"Tag\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵelement(4, \"input\", 32);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function ProductEditComponent_div_48_Template_button_click_5_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const i_r3 = restoredCtx.index;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.deleteTag(i_r3));\n    });\n    i0.ɵɵtext(6, \"Delete Tag \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r3 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵattribute(\"for\", i_r3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"id\", i_r3)(\"formControlName\", i_r3);\n  }\n}\nfunction ProductEditComponent_div_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 34);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r1.errorMessage, \" \");\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"is-invalid\": a0\n  };\n};\nconst _c1 = function () {\n  return [\"/products\"];\n};\nclass ProductEditComponent {\n  get tags() {\n    return this.productForm.get('tags');\n  }\n  constructor(fb, route, router, productService) {\n    this.fb = fb;\n    this.route = route;\n    this.router = router;\n    this.productService = productService;\n    this.pageTitle = 'Product Edit';\n    this.errorMessage = '';\n    this.selectedImageFile = null;\n    // Use with the generic validation message class\n    this.displayMessage = {};\n    // Defines all of the validation messages for the form.\n    // These could instead be retrieved from a file or database.\n    this.validationMessages = {\n      productName: {\n        required: 'Product name is required.',\n        minlength: 'Product name must be at least three characters.',\n        maxlength: 'Product name cannot exceed 50 characters.'\n      },\n      productCode: {\n        required: 'Product code is required.'\n      },\n      starRating: {\n        range: 'Rate the product between 1 (lowest) and 5 (highest).'\n      }\n    };\n    // Define an instance of the validator for use with this form,\n    // passing in this form's set of validation messages.\n    this.genericValidator = new GenericValidator(this.validationMessages);\n  }\n  ngOnInit() {\n    this.productForm = this.fb.group({\n      productName: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(50)]],\n      productCode: ['', Validators.required],\n      starRating: ['', NumberValidators.range(1, 5)],\n      releaseDate: [''],\n      price: [''],\n      imageFile: [],\n      //imageUrl: [''],\n      tags: this.fb.array([]),\n      description: ''\n    });\n    // Read the product Id from the route parameter\n    this.sub = this.route.paramMap.subscribe(params => {\n      const id = Number(this.route.snapshot.paramMap.get('id'));\n      this.getProduct(id);\n    });\n  }\n  ngOnDestroy() {\n    this.sub.unsubscribe();\n  }\n  ngAfterViewInit() {\n    // Watch for the blur event from any input element on the form.\n    // This is required because the valueChanges does not provide notification on blur\n    const controlBlurs = this.formInputElements.map(formControl => fromEvent(formControl.nativeElement, 'blur'));\n    // Merge the blur event observable with the valueChanges observable\n    // so we only need to subscribe once.\n    merge(this.productForm.valueChanges, ...controlBlurs).pipe(debounceTime(800)).subscribe(value => {\n      this.displayMessage = this.genericValidator.processMessages(this.productForm);\n    });\n  }\n  addTag() {\n    this.tags.push(new FormControl());\n  }\n  deleteTag(index) {\n    this.tags.removeAt(index);\n    this.tags.markAsDirty();\n  }\n  getProduct(id) {\n    console.log(id);\n    this.productService.getProduct(id).subscribe({\n      next: product => this.displayProduct(product),\n      error: err => this.errorMessage = err\n    });\n  }\n  displayProduct(product) {\n    if (this.productForm) {\n      this.productForm.reset();\n    }\n    this.product = product;\n    if (this.product.id === 0) {\n      this.pageTitle = 'Add Product';\n    } else {\n      this.pageTitle = `Edit Product: ${this.product.productName}`;\n    }\n    // Update the data on the form\n    this.productForm.patchValue({\n      productName: this.product.productName,\n      productCode: this.product.productCode,\n      starRating: this.product.starRating,\n      releaseDate: this.product.releaseDate,\n      price: this.product.price,\n      imageUrl: this.product.imageUrl,\n      description: this.product.description\n    });\n    this.productForm.setControl('tags', this.fb.array(this.product.tags || []));\n  }\n  deleteProduct() {\n    if (this.product.id === 0) {\n      // Don't delete, it was never saved.\n      this.onSaveComplete();\n    } else if (this.product.id) {\n      if (confirm(`Really delete the product: ${this.product.productName}?`)) {\n        this.productService.deleteProduct(this.product.id).subscribe({\n          next: () => this.onSaveComplete(),\n          error: err => this.errorMessage = err\n        });\n      }\n    }\n  }\n  /* saveProduct(): void {\n    if (this.productForm.valid) {\n      if (this.productForm.dirty) {\n        const p = { ...this.product, ...this.productForm.value };\n           if (p.id === 0) {\n          this.productService.createProduct(p)\n            .subscribe({\n              next: x => {\n                console.log(x);\n                return this.onSaveComplete();\n              },\n              error: err => this.errorMessage = err\n            });\n        } else {\n          this.productService.updateProduct(p)\n            .subscribe({\n              next: () => this.onSaveComplete(),\n              error: err => this.errorMessage = err\n            });\n        }\n      } else {\n        this.onSaveComplete();\n      }\n    } else {\n      this.errorMessage = 'Please correct the validation errors.';\n    }\n  } */\n  saveProduct() {\n    if (this.productForm.valid) {\n      if (this.productForm.dirty) {\n        const productData = {\n          ...this.product,\n          ...this.productForm.value\n        };\n        console.log('Selected Image File:', this.selectedImageFile);\n        const formData = new FormData();\n        formData.append('productName', productData.productName);\n        formData.append('productCode', productData.productCode);\n        formData.append('starRating', productData.starRating.toString());\n        formData.append('description', productData.description);\n        formData.append('price', productData.price.toString());\n        formData.append('releaseDate', productData.releaseDate);\n        // Append the selected image file to the FormData\n        if (this.selectedImageFile) {\n          formData.append('image', this.selectedImageFile);\n        }\n        if (productData.id === 0) {\n          this.productService.createProductWithImage(formData, productData).subscribe({\n            next: x => {\n              const message = response.message;\n              console.log(`${message}`);\n              console.log(productData);\n              return this.onSaveComplete();\n            },\n            error: err => this.errorMessage = err\n          });\n        } else {\n          this.productService.updateProduct(productData).subscribe({\n            next: () => this.onSaveComplete(),\n            error: err => this.errorMessage = err\n          });\n          /* this.productService.updateProductWithImage(productData.id, formData, productData)\n            .subscribe({\n              next: () => this.onSaveComplete(),\n              error: err => this.errorMessage = err\n            }); */\n        }\n      } else {\n        this.onSaveComplete();\n      }\n    } else {\n      this.errorMessage = 'Please correct the validation errors.';\n    }\n  }\n  onSaveComplete() {\n    // Reset the form to clear the flags\n    this.productForm.reset();\n    this.router.navigate(['/products']);\n  }\n  onImageChange(event) {\n    const file = event.target.files[0];\n    this.selectedImageFile = file;\n  }\n}\n_class = ProductEditComponent;\n_class.ɵfac = function ProductEditComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.ProductService));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"ng-component\"]],\n  viewQuery: function ProductEditComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(FormControlName, 5, ElementRef);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.formInputElements = _t);\n    }\n  },\n  decls: 69,\n  vars: 36,\n  consts: [[1, \"card\"], [1, \"card-header\"], [1, \"card-body\"], [\"novalidate\", \"\", 3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\", \"row\", \"mb-2\"], [\"for\", \"productNameId\", 1, \"col-md-2\", \"col-form-label\"], [1, \"col-md-8\"], [\"id\", \"productNameId\", \"type\", \"text\", \"placeholder\", \"Name (required)\", \"formControlName\", \"productName\", 1, \"form-control\", 3, \"ngClass\"], [1, \"invalid-feedback\"], [\"for\", \"productCodeId\", 1, \"col-md-2\", \"col-form-label\"], [\"id\", \"productCodeId\", \"type\", \"text\", \"placeholder\", \"Code (required)\", \"formControlName\", \"productCode\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"starRatingId\", 1, \"col-md-2\", \"col-form-label\"], [\"id\", \"starRatingId\", \"type\", \"text\", \"placeholder\", \"Rating (1-5)\", \"formControlName\", \"starRating\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"releaseDate\", 1, \"col-md-2\", \"col-form-label\"], [\"id\", \"releaseDate\", \"type\", \"text\", \"placeholder\", \"Enter Release Date\", \"formControlName\", \"releaseDate\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"price\", 1, \"col-md-2\", \"col-form-label\"], [\"id\", \"price\", \"type\", \"text\", \"placeholder\", \"Enter Price\", \"formControlName\", \"price\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"imageFile\", 1, \"col-md-2\", \"col-form-label\"], [\"id\", \"imageFile\", \"type\", \"file\", \"accept\", \".jpg, .jpeg, .png\", 1, \"form-control\", 3, \"ngClass\", \"change\"], [\"formArrayName\", \"tags\"], [\"class\", \"form-group row mb-2\", 4, \"ngFor\", \"ngForOf\"], [1, \"row\"], [1, \"col-md-2\", \"mb-2\"], [\"type\", \"button\", \"title\", \"Add a search tag\", 1, \"btn\", \"btn-outline-secondary\", \"btn-sm\", 3, \"click\"], [\"for\", \"descriptionId\", 1, \"col-md-2\", \"col-form-label\"], [\"id\", \"descriptionId\", \"placeholder\", \"Description\", \"rows\", \"3\", \"formControlName\", \"description\", 1, \"form-control\", 3, \"ngClass\"], [1, \"offset-md-2\", \"col-md-4\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"mr-3\", 2, \"width\", \"80px\", 3, \"title\", \"disabled\"], [\"type\", \"button\", \"title\", \"Cancel your edits\", 1, \"btn\", \"btn-outline-secondary\", \"mr-3\", 2, \"width\", \"80px\", 3, \"routerLink\"], [\"type\", \"button\", \"title\", \"Delete this product\", 1, \"btn\", \"btn-outline-warning\", 2, \"width\", \"80px\", 3, \"click\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [1, \"col-md-2\", \"col-form-label\"], [\"type\", \"text\", \"placeholder\", \"Tag\", 1, \"form-control\", 3, \"id\", \"formControlName\"], [\"type\", \"button\", \"title\", \"Delete this search tag\", 1, \"col-md-1\", \"btn\", \"btn-outline-warning\", \"btn-sm\", 3, \"click\"], [1, \"alert\", \"alert-danger\"]],\n  template: function ProductEditComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n      i0.ɵɵtext(2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 2)(4, \"form\", 3);\n      i0.ɵɵlistener(\"ngSubmit\", function ProductEditComponent_Template_form_ngSubmit_4_listener() {\n        return ctx.saveProduct();\n      });\n      i0.ɵɵelementStart(5, \"div\", 4)(6, \"label\", 5);\n      i0.ɵɵtext(7, \"Product Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"div\", 6);\n      i0.ɵɵelement(9, \"input\", 7);\n      i0.ɵɵelementStart(10, \"span\", 8);\n      i0.ɵɵtext(11);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(12, \"div\", 4)(13, \"label\", 9);\n      i0.ɵɵtext(14, \"Product Code\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"div\", 6);\n      i0.ɵɵelement(16, \"input\", 10);\n      i0.ɵɵelementStart(17, \"span\", 8);\n      i0.ɵɵtext(18);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(19, \"div\", 4)(20, \"label\", 11);\n      i0.ɵɵtext(21, \"Star Rating (1-5)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"div\", 6);\n      i0.ɵɵelement(23, \"input\", 12);\n      i0.ɵɵelementStart(24, \"span\", 8);\n      i0.ɵɵtext(25);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(26, \"div\", 4)(27, \"label\", 13);\n      i0.ɵɵtext(28, \"Release Date\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(29, \"div\", 6);\n      i0.ɵɵelement(30, \"input\", 14);\n      i0.ɵɵelementStart(31, \"span\", 8);\n      i0.ɵɵtext(32);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(33, \"div\", 4)(34, \"label\", 15);\n      i0.ɵɵtext(35, \"Price\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(36, \"div\", 6);\n      i0.ɵɵelement(37, \"input\", 16);\n      i0.ɵɵelementStart(38, \"span\", 8);\n      i0.ɵɵtext(39);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(40, \"div\", 4)(41, \"label\", 17);\n      i0.ɵɵtext(42, \"Image Upload\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(43, \"div\", 6)(44, \"input\", 18);\n      i0.ɵɵlistener(\"change\", function ProductEditComponent_Template_input_change_44_listener($event) {\n        return ctx.onImageChange($event);\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(45, \"span\", 8);\n      i0.ɵɵtext(46);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(47, \"div\", 19);\n      i0.ɵɵtemplate(48, ProductEditComponent_div_48_Template, 7, 3, \"div\", 20);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"div\", 21)(50, \"div\", 22)(51, \"button\", 23);\n      i0.ɵɵlistener(\"click\", function ProductEditComponent_Template_button_click_51_listener() {\n        return ctx.addTag();\n      });\n      i0.ɵɵtext(52, \"Add Tag \");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(53, \"div\", 4)(54, \"label\", 24);\n      i0.ɵɵtext(55, \"Description\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(56, \"div\", 6);\n      i0.ɵɵelement(57, \"textarea\", 25);\n      i0.ɵɵelementStart(58, \"span\", 8);\n      i0.ɵɵtext(59);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(60, \"div\", 4)(61, \"div\", 26)(62, \"button\", 27);\n      i0.ɵɵtext(63, \" Save \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(64, \"button\", 28);\n      i0.ɵɵtext(65, \" Cancel \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(66, \"button\", 29);\n      i0.ɵɵlistener(\"click\", function ProductEditComponent_Template_button_click_66_listener() {\n        return ctx.deleteProduct();\n      });\n      i0.ɵɵtext(67, \" Delete \");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵtemplate(68, ProductEditComponent_div_68_Template, 2, 1, \"div\", 30);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.pageTitle, \" \");\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"formGroup\", ctx.productForm);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(21, _c0, ctx.displayMessage.productName));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.productName, \" \");\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(23, _c0, ctx.displayMessage.productCode));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.productCode, \" \");\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(25, _c0, ctx.displayMessage.starRating));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.starRating, \" \");\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(27, _c0, ctx.displayMessage.releaseDate));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.releaseDate, \" \");\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(29, _c0, ctx.displayMessage.price));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.price, \" \");\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(31, _c0, ctx.displayMessage.imageUrl));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.imageUrl, \" \");\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.tags.controls);\n      i0.ɵɵadvance(9);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(33, _c0, ctx.displayMessage.description));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.displayMessage.description, \" \");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"title\", ctx.productForm.valid ? \"Save your entered data\" : \"Disabled until the form data is valid\")(\"disabled\", !ctx.productForm.valid);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(35, _c1));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n    }\n  },\n  dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i1.FormArrayName, i2.RouterLink],\n  encapsulation: 2\n});\nexport { ProductEditComponent };","map":{"version":3,"names":["ElementRef","FormControl","Validators","FormControlName","fromEvent","merge","debounceTime","NumberValidators","GenericValidator","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵelement","ɵɵlistener","ProductEditComponent_div_48_Template_button_click_5_listener","restoredCtx","ɵɵrestoreView","_r5","i_r3","index","ctx_r4","ɵɵnextContext","ɵɵresetView","deleteTag","ɵɵadvance","ɵɵattribute","ɵɵproperty","ɵɵtextInterpolate1","ctx_r1","errorMessage","ProductEditComponent","tags","productForm","get","constructor","fb","route","router","productService","pageTitle","selectedImageFile","displayMessage","validationMessages","productName","required","minlength","maxlength","productCode","starRating","range","genericValidator","ngOnInit","group","minLength","maxLength","releaseDate","price","imageFile","array","description","sub","paramMap","subscribe","params","id","Number","snapshot","getProduct","ngOnDestroy","unsubscribe","ngAfterViewInit","controlBlurs","formInputElements","map","formControl","nativeElement","valueChanges","pipe","value","processMessages","addTag","push","removeAt","markAsDirty","console","log","next","product","displayProduct","error","err","reset","patchValue","imageUrl","setControl","deleteProduct","onSaveComplete","confirm","saveProduct","valid","dirty","productData","formData","FormData","append","toString","createProductWithImage","x","message","response","updateProduct","navigate","onImageChange","event","file","target","files","ɵɵdirectiveInject","i1","FormBuilder","i2","ActivatedRoute","Router","i3","ProductService","selectors","viewQuery","ProductEditComponent_Query","rf","ctx","ProductEditComponent_Template_form_ngSubmit_4_listener","ProductEditComponent_Template_input_change_44_listener","$event","ɵɵtemplate","ProductEditComponent_div_48_Template","ProductEditComponent_Template_button_click_51_listener","ProductEditComponent_Template_button_click_66_listener","ProductEditComponent_div_68_Template","ɵɵpureFunction1","_c0","controls","ɵɵpureFunction0","_c1"],"sources":["C:\\Users\\hp\\OneDrive\\Desktop\\P10 - Training\\angular\\Angular Project - apm\\src\\app\\products\\product-edit.component.ts","C:\\Users\\hp\\OneDrive\\Desktop\\P10 - Training\\angular\\Angular Project - apm\\src\\app\\products\\product-edit.component.html"],"sourcesContent":["import { Component, OnInit, AfterViewInit, OnDestroy, ViewChildren, ElementRef } from '@angular/core';\r\nimport { FormBuilder, FormGroup, FormControl, FormArray, Validators, FormControlName } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\n\r\nimport { Observable, Subscription, fromEvent, merge } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { Product } from './product';\r\nimport { ProductService } from './product.service';\r\n\r\nimport { NumberValidators } from '../shared/number.validator';\r\nimport { GenericValidator } from '../shared/generic-validator';\r\n\r\n@Component({\r\n  templateUrl: './product-edit.component.html'\r\n})\r\nexport class ProductEditComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  @ViewChildren(FormControlName, { read: ElementRef }) formInputElements!: ElementRef[];\r\n\r\n  pageTitle = 'Product Edit';\r\n  errorMessage = '';\r\n  productForm!: FormGroup;\r\n\r\n  product!: Product;\r\n  private sub!: Subscription;\r\n\r\n  selectedImageFile: File | null = null;\r\n\r\n  // Use with the generic validation message class\r\n  displayMessage: { [key: string]: string } = {};\r\n  private validationMessages: { [key: string]: { [key: string]: string } };\r\n  private genericValidator: GenericValidator;\r\n\r\n  get tags(): FormArray {\r\n    return this.productForm.get('tags') as FormArray;\r\n  }\r\n\r\n  constructor(private fb: FormBuilder,\r\n              private route: ActivatedRoute,\r\n              private router: Router,\r\n              private productService: ProductService,\r\n              ) {\r\n\r\n    // Defines all of the validation messages for the form.\r\n    // These could instead be retrieved from a file or database.\r\n    this.validationMessages = {\r\n      productName: {\r\n        required: 'Product name is required.',\r\n        minlength: 'Product name must be at least three characters.',\r\n        maxlength: 'Product name cannot exceed 50 characters.'\r\n      },\r\n      productCode: {\r\n        required: 'Product code is required.'\r\n      },\r\n      starRating: {\r\n        range: 'Rate the product between 1 (lowest) and 5 (highest).'\r\n      }\r\n    };\r\n\r\n    // Define an instance of the validator for use with this form,\r\n    // passing in this form's set of validation messages.\r\n    this.genericValidator = new GenericValidator(this.validationMessages);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.productForm = this.fb.group({\r\n      productName: ['', [Validators.required,\r\n                         Validators.minLength(3),\r\n                         Validators.maxLength(50)]],\r\n      productCode: ['', Validators.required],\r\n      starRating: ['', NumberValidators.range(1, 5)],\r\n      releaseDate: [''],\r\n      price: [''],\r\n      imageFile: [],\r\n      //imageUrl: [''],\r\n      tags: this.fb.array([]),\r\n      description: ''\r\n    });\r\n\r\n    // Read the product Id from the route parameter\r\n    this.sub = this.route.paramMap.subscribe(\r\n      params => {\r\n        const id = Number(this.route.snapshot.paramMap.get('id'));\r\n        this.getProduct(id);\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.sub.unsubscribe();\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    // Watch for the blur event from any input element on the form.\r\n    // This is required because the valueChanges does not provide notification on blur\r\n    const controlBlurs: Observable<any>[] = this.formInputElements\r\n      .map((formControl: ElementRef) => fromEvent(formControl.nativeElement, 'blur'));\r\n\r\n    // Merge the blur event observable with the valueChanges observable\r\n    // so we only need to subscribe once.\r\n    merge(this.productForm.valueChanges, ...controlBlurs).pipe(\r\n      debounceTime(800)\r\n    ).subscribe(value => {\r\n      this.displayMessage = this.genericValidator.processMessages(this.productForm);\r\n    });\r\n  }\r\n\r\n  addTag(): void {\r\n    this.tags.push(new FormControl());\r\n  }\r\n\r\n  deleteTag(index: number): void {\r\n    this.tags.removeAt(index);\r\n    this.tags.markAsDirty();\r\n  }\r\n\r\n  getProduct(id: number): void {\r\n    console.log(id)\r\n    this.productService.getProduct(id)\r\n      .subscribe({\r\n        next: (product: Product) => this.displayProduct(product),\r\n        error: err => this.errorMessage = err\r\n      });\r\n  }\r\n\r\n  displayProduct(product: Product): void {\r\n    if (this.productForm) {\r\n      this.productForm.reset();\r\n    }\r\n    this.product = product;\r\n\r\n    if (this.product.id === 0) {\r\n      this.pageTitle = 'Add Product';\r\n    } else {\r\n      this.pageTitle = `Edit Product: ${this.product.productName}`;\r\n    }\r\n\r\n    // Update the data on the form\r\n    this.productForm.patchValue({\r\n      productName: this.product.productName,\r\n      productCode: this.product.productCode,\r\n      starRating: this.product.starRating,\r\n      releaseDate: this.product.releaseDate,\r\n      price: this.product.price,\r\n      imageUrl: this.product.imageUrl,\r\n      description: this.product.description\r\n    });\r\n    this.productForm.setControl('tags', this.fb.array(this.product.tags || []));\r\n  }\r\n\r\n  deleteProduct(): void {\r\n    if (this.product.id === 0) {\r\n      // Don't delete, it was never saved.\r\n      this.onSaveComplete();\r\n    } else if (this.product.id) {\r\n      if (confirm(`Really delete the product: ${this.product.productName}?`)) {\r\n        this.productService.deleteProduct(this.product.id)\r\n          .subscribe({\r\n            next: () => this.onSaveComplete(),\r\n            error: err => this.errorMessage = err\r\n          });\r\n      }\r\n    }\r\n  }\r\n\r\n  /* saveProduct(): void {\r\n    if (this.productForm.valid) {\r\n      if (this.productForm.dirty) {\r\n        const p = { ...this.product, ...this.productForm.value };\r\n\r\n        if (p.id === 0) {\r\n          this.productService.createProduct(p)\r\n            .subscribe({\r\n              next: x => {\r\n                console.log(x);\r\n                return this.onSaveComplete();\r\n              },\r\n              error: err => this.errorMessage = err\r\n            });\r\n        } else {\r\n          this.productService.updateProduct(p)\r\n            .subscribe({\r\n              next: () => this.onSaveComplete(),\r\n              error: err => this.errorMessage = err\r\n            });\r\n        }\r\n      } else {\r\n        this.onSaveComplete();\r\n      }\r\n    } else {\r\n      this.errorMessage = 'Please correct the validation errors.';\r\n    }\r\n  } */\r\n\r\n  saveProduct(): void {\r\n    if (this.productForm.valid) {\r\n      if (this.productForm.dirty) {\r\n        const productData = { ...this.product, ...this.productForm.value };\r\n        console.log('Selected Image File:', this.selectedImageFile);\r\n        const formData = new FormData();\r\n        formData.append('productName', productData.productName);\r\n        formData.append('productCode', productData.productCode);\r\n        formData.append('starRating', productData.starRating.toString());\r\n        formData.append('description', productData.description);\r\n        formData.append('price', productData.price.toString());\r\n        formData.append('releaseDate', productData.releaseDate);\r\n  \r\n        // Append the selected image file to the FormData\r\n        if (this.selectedImageFile) {\r\n          formData.append('image', this.selectedImageFile);\r\n        }\r\n  \r\n        if (productData.id === 0) {\r\n          this.productService.createProductWithImage(formData, productData)\r\n            .subscribe({\r\n              next: x => {\r\n                const message = response.message;\r\n                console.log(`${message}`)\r\n                console.log(productData);\r\n                return this.onSaveComplete();\r\n              },\r\n              error: err => this.errorMessage = err\r\n            });\r\n        } else {\r\n          this.productService.updateProduct(productData)\r\n          .subscribe({\r\n            next: () => this.onSaveComplete(),\r\n            error: err => this.errorMessage = err\r\n          });\r\n          /* this.productService.updateProductWithImage(productData.id, formData, productData)\r\n            .subscribe({\r\n              next: () => this.onSaveComplete(),\r\n              error: err => this.errorMessage = err\r\n            }); */\r\n        }\r\n      } else {\r\n        this.onSaveComplete();\r\n      }\r\n    } else {\r\n      this.errorMessage = 'Please correct the validation errors.';\r\n    }\r\n  }\r\n  \r\n\r\n  onSaveComplete(): void {\r\n    // Reset the form to clear the flags\r\n    this.productForm.reset();\r\n    this.router.navigate(['/products']);\r\n  }\r\n\r\n  onImageChange(event: any): void {\r\n  const file = event.target.files[0];\r\n  this.selectedImageFile = file;\r\n}\r\n\r\n\r\n}\r\n","<div class=\"card\">\r\n  <div class=\"card-header\">\r\n    {{pageTitle}}\r\n  </div>\r\n\r\n  <div class=\"card-body\">\r\n    <form novalidate\r\n          (ngSubmit)=\"saveProduct()\"\r\n          [formGroup]=\"productForm\">\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"productNameId\">Product Name</label>\r\n        <div class=\"col-md-8\">\r\n          <input class=\"form-control\"\r\n                 id=\"productNameId\"\r\n                 type=\"text\"\r\n                 placeholder=\"Name (required)\"\r\n                 formControlName=\"productName\"\r\n                 [ngClass]=\"{'is-invalid': displayMessage.productName }\" />\r\n          <span class=\"invalid-feedback\">\r\n            {{displayMessage.productName}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"productCodeId\">Product Code</label>\r\n        <div class=\"col-md-8\">\r\n          <input class=\"form-control\"\r\n                 id=\"productCodeId\"\r\n                 type=\"text\"\r\n                 placeholder=\"Code (required)\"\r\n                 formControlName=\"productCode\"\r\n                 [ngClass]=\"{'is-invalid': displayMessage.productCode}\" />\r\n          <span class=\"invalid-feedback\">\r\n            {{displayMessage.productCode}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"starRatingId\">Star Rating (1-5)</label>\r\n\r\n        <div class=\"col-md-8\">\r\n          <input class=\"form-control\"\r\n                 id=\"starRatingId\"\r\n                 type=\"text\"\r\n                 placeholder=\"Rating (1-5)\"\r\n                 formControlName=\"starRating\"\r\n                 [ngClass]=\"{'is-invalid': displayMessage.starRating}\" />\r\n          <span class=\"invalid-feedback\">\r\n            {{displayMessage.starRating}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"releaseDate\">Release Date</label>\r\n\r\n        <div class=\"col-md-8\">\r\n          <input class=\"form-control\"\r\n                 id=\"releaseDate\"\r\n                 type=\"text\"\r\n                 placeholder=\"Enter Release Date\"\r\n                 formControlName=\"releaseDate\"\r\n                 [ngClass]=\"{'is-invalid': displayMessage.releaseDate}\" />\r\n          <span class=\"invalid-feedback\">\r\n            {{displayMessage.releaseDate}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"price\">Price</label>\r\n\r\n        <div class=\"col-md-8\">\r\n          <input class=\"form-control\"\r\n                 id=\"price\"\r\n                 type=\"text\"\r\n                 placeholder=\"Enter Price\"\r\n                 formControlName=\"price\"\r\n                 [ngClass]=\"{'is-invalid': displayMessage.price}\" />\r\n          <span class=\"invalid-feedback\">\r\n            {{displayMessage.price}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"imageFile\">Image Upload</label>\r\n        <div class=\"col-md-8\">\r\n          <input class=\"form-control\"\r\n                 id=\"imageFile\"\r\n                 type=\"file\"\r\n                 (change)=\"onImageChange($event)\"\r\n                 accept=\".jpg, .jpeg, .png\"\r\n                 [ngClass]=\"{'is-invalid': displayMessage.imageUrl}\" />\r\n          <span class=\"invalid-feedback\">\r\n            {{displayMessage.imageUrl}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div formArrayName=\"tags\">\r\n        <div class=\"form-group row mb-2\"\r\n             *ngFor=\"let tag of tags.controls; let i=index\">\r\n          <label class=\"col-md-2 col-form-label\"\r\n                 [attr.for]=\"i\">Tag</label>\r\n\r\n          <div class=\"col-md-8\">\r\n            <input class=\"form-control\"\r\n                   [id]=\"i\"\r\n                   type=\"text\"\r\n                   placeholder=\"Tag\"\r\n                   [formControlName]=\"i\" />\r\n          </div>\r\n          <button class=\"col-md-1 btn btn-outline-warning btn-sm\"\r\n                  type=\"button\"\r\n                  title=\"Delete this search tag\"\r\n                  (click)=\"deleteTag(i)\">Delete Tag\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"row\">\r\n        <div class=\"col-md-2 mb-2\">\r\n          <button class=\"btn btn-outline-secondary btn-sm\"\r\n                  type=\"button\"\r\n                  title=\"Add a search tag\"\r\n                  (click)=\"addTag()\">Add Tag\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group row mb-2\">\r\n        <label class=\"col-md-2 col-form-label\"\r\n               for=\"descriptionId\">Description</label>\r\n\r\n        <div class=\"col-md-8\">\r\n          <textarea class=\"form-control\"\r\n                    id=\"descriptionId\"\r\n                    placeholder=\"Description\"\r\n                    rows=3\r\n                    formControlName=\"description\"\r\n                    [ngClass]=\"{'is-invalid': displayMessage.description}\"></textarea>\r\n          <span class=\"invalid-feedback\">\r\n            {{ displayMessage.description}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"form-group row mb-2\">\r\n        <div class=\"offset-md-2 col-md-4\">\r\n          <button class=\"btn btn-primary mr-3\"\r\n                  style=\"width:80px;\"\r\n                  type=\"submit\"\r\n                  [title]=\"productForm.valid ? 'Save your entered data' : 'Disabled until the form data is valid'\"\r\n                  [disabled]=\"!productForm.valid\">\r\n            Save\r\n          </button>\r\n          <button class=\"btn btn-outline-secondary mr-3\"\r\n                  style=\"width:80px;\"\r\n                  type=\"button\"\r\n                  title=\"Cancel your edits\"\r\n                  [routerLink]=\"['/products']\">\r\n            Cancel\r\n          </button>\r\n          <button class=\"btn btn-outline-warning\"\r\n                  style=\"width:80px\"\r\n                  type=\"button\"\r\n                  title=\"Delete this product\"\r\n                  (click)=\"deleteProduct()\">\r\n            Delete\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n\r\n  <div class=\"alert alert-danger\"\r\n       *ngIf=\"errorMessage\">{{errorMessage}}\r\n  </div>\r\n</div>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}